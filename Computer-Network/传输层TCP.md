# TCP详解:

![TCP](https://img-blog.csdn.net/20170518194207748?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMTc4NDQ5NQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

1、端口号：用来标识同一台计算机的不同的应用进程。

1）源端口：源端口和IP地址的作用是标识报文的返回地址。

2）目的端口：端口指明接收方计算机上的应用程序接口。

TCP报头中的源端口号和目的端口号同IP数据报中的源IP与目的IP唯一确定一条TCP连接。

2、序号和确认号：是TCP可靠传输的关键部分。序号是本报文段发送的数据组的第一个字节的序号。在TCP传送的流中，每一个字节一个序号。e.g.一个报文段的序号为300，此报文段数据部分共有100字节，则
下一个报文段的序号为400。所以序号确保了TCP传输的有序性。确认号，即ACK，指明下一个期待收到的字节序号，表明该序号之前的所有数据已经正确无误的收到。确认号只有当ACK标志为1时才有效。比如
建立连接时，SYN报文的ACK标志位为0。

3、数据偏移／首部长度：4bits。由于首部可能含有可选项内容，因此TCP报头的长度是不确定的，报头不包含任何任选字段则长度为20字节，4位首部长度字段所能表示的最大值为1111，转化为10进制为15，15\*32/8 = 60，
故报头最大长度为60字节。首部长度也叫数据偏移，是因为首部长度实际上指示了数据区在报文段中的起始偏移值。

4、保留：为将来定义新的用途保留，现在一般置0。

5、控制位：URG  ACK  PSH  RST  SYN  FIN，共6个，每一个标志位表示一个控制功能。

1）URG：紧急指针标志，为1时表示紧急指针有效，为0则忽略紧急指针。

2）ACK：确认序号标志，为1时表示确认号有效，为0表示报文中不含确认信息，忽略确认号字段。

3）PSH：push标志，为1表示是带有push标志的数据，指示接收方在接收到该报文段以后，应尽快将这个报文段交给应用程序，而不是在缓冲区排队。

4）RST：重置连接标志，用于重置由于主机崩溃或其他原因而出现错误的连接。或者用于拒绝非法的报文段和拒绝连接请求。

5）SYN：同步序号，用于建立连接过程，在连接请求中，SYN=1和ACK=0表示该数据段没有使用捎带的确认域，而连接应答捎带一个确认，即SYN=1和ACK=1。

6）FIN：finish标志，用于释放连接，为1时表示发送方已经没有数据发送了，即关闭本方数据流。

6、窗口：滑动窗口大小，用来告知发送端接受端的缓存大小，以此控制发送端发送数据的速率，从而达到流量控制。窗口大小时一个16bit字段，因而窗口大小最大为65535。

7、校验和：奇偶校验，此校验和是对整个的 TCP 报文段，包括 TCP 头部和 TCP 数据，以 16 位字进行计算所得。由发送端计算和存储，并由接收端进行验证。

8、紧急指针：只有当 URG 标志置 1 时紧急指针才有效。紧急指针是一个正的偏移量，和顺序号字段中的值相加表示紧急数据最后一个字节的序号。 TCP 的紧急方式是发送端向另一端发送紧急数据的一种方式。

9、选项和填充：最常见的可选字段是最长报文大小，又称为MSS（Maximum Segment Size），每个连接方通常都在通信的第一个报文段（为建立连接而设置SYN标志为1的那个段）中指明这个选项，它表示本端所能接受的最大报文段的长度。选项长度不一定是32位的整数倍，所以要加填充位，即在这个字段中加入额外的零，以保证TCP头是32的整数倍。

10、数据部分： TCP 报文段中的数据部分是可选的。在一个连接建立和一个连接终止时，双方交换的报文段仅有 TCP 首部。如果一方没有数据要发送，也使用没有任何数据的首部来确认收到的数据。在处理超时的许多情况中，也会发送不带任何数据的报文段。
--------------------- 
作者：海阔天空sky1992 
来源：CSDN 
原文：https://blog.csdn.net/Mary19920410/article/details/58030147 
版权声明：本文为博主原创文章，转载请附上博文链接！

# 基础例题:
1单选(2分)
主机甲向主机乙发送一个(SYN = 1, Seq = x)的TCP段，期望与主机乙建立TCP连接，

若主机乙接受该连接请求，则主机乙向主机甲发送的正确的TCP段可能是


得分/总分

A.
(SYN = 1, ACK = 1, Seq = x+1, Ack = y)  


B.
(SYN = 0, ACK = 0, Seq =x+1 , Ack = y) 


C.
(SYN = 0, ACK = 0, Seq = y, Ack = x+1)  


D.
(SYN = 1, ACK = 1, Seq =y , Ack =x+1 )

正确答案：D你没选择任何选项
解析：  D、服务器乙的 TCP 收到甲的连接请求报文段后，则发回确认，ACK应置为1，确认序号应为Ack = 1（因为之前的连接请求报文段中Seq=x，需要消耗掉一个序号，所以服务器B此时期望接收的序号应该是Ack = x+1）。
因为连接是双向的，所以服务器乙也向主机甲发出请求建立连接的请求，在报文段中同时应将 SYN 置为1，为自己选择一个初始序号Seq = y。
2单选(2分)
若主机甲和乙之间已建立一个TCP连接，双方持续有数据传输，数据无差错和丢失。若甲收到一个来自乙的TCP报文段，该段的Seq=1012，Ack=2046，该段的有效载荷是100字节，则甲立即发送给乙的TCP报文段中Seq和Ack分别是

得分/总分

A.
 2047,1111  


B.
2046,1111 


C.
 2046，1112  


D.
2047,1112

正确答案：C你没选择任何选项
解析：  C、甲收到一个来自乙的TCP报文段，该段的Seq=1012，Ack=2046，有效载荷是100字节，则甲立即发送给乙的TCP报文段中Seq=2046，Ack=1012+100=1112。
3单选(2分)
TCP报文段首部的16进制为04 85 00 50 2E 7C 84 03 FE 34 D7 47 50 11 FF 6C DE 69 00 00，则这个TCP报文段首部中源端口的值（16进制数）为


得分/总分

A.
2E 7C


B.
00 50


C.
04 85


D.
84 03

正确答案：C你没选择任何选项
解析：  C、端口是传输层与应用层的服务接口。在TCP报文段一开始的字段是源端口号，占16bit 。
4单选(2分)
TCP报文段首部的16进制为04 85 00 50 2E 7C 84 03 FE 34 D7 47 50 11 FF 6C DE 69 00 00，则这个TCP报文段首部中目的端口的值（16进制数）为

得分/总分

A.
84 03


B.
04 85


C.
00 50


D.
2E 7C 

正确答案：C你没选择任何选项
解析：  C、端口是传输层与应用层的服务接口。在TCP报文段一开始的第三和第四字节是目的端口号 。

TCP只能提供一对一的传输服务。
7填空(2分)
如果TCP来回路程时间RTT的当前值是30ms，随后应答在34ms时候到来，取α=0.9，那么新的RTT估算值是（     ）ms。

得分/总分
你没有填写答案
正确答案：30.4
解析： 每测量到一个新的往返时延样本，就按下式重新计算一次平均往返时延：
RTTnew = RTTsample（第一次测量得到的RTT样本值）
RTTnew＝ α×RTTold+（l-α）×RTTsample（第二次以后的测量）
则RTTnew＝ 0.9×30+（l-0.9）×34=30.4 ms
8填空(2分)
主机甲与主机乙之间建立一个TCP连接，主机甲向主机乙发送了两个连续的报文段，分别包含200字节和500字节的有效载荷，第一个报文段的序号为100，主机乙正确接收到两个段后，发送给主机甲的确认号为（      ）。

得分/总分
你没有填写答案
正确答案：800
解析： 因为第一个报文段的序号是100，也就是说，第一个TCP报文段第一字节的编号是100，又因为第一个报文段和第二个报文段分别包含200字节和500字节的有效载荷，则第二个TCP报文段数据部分最后一个字节的
编号是100+200+500-1=799，所以，主机乙正确接收到两个段后，发送给主机甲的确认号为最后一个字节的编号加1，即799+1=800。
9填空(2分)
以太网的数据帧封装中，包含在TCP段中的数据部分最长应该是（      ）字节。（注：本题中IP和TCP都只有首部固定长度，且以太网的MTU=1500字节）


得分/总分
你没有填写答案
正确答案：1460
解析： 因为以太网的MTU=1500字节，所以封装在帧中的IP数据报的总长度最大值=1500字节，再减去IP的首部和TCP的首部各20字节，所以最终的答案为1500-20-20=1460字节。
10填空(2分)
一个UDP用户数据报的数据字段长度为3752字节。若使用以太网来传送（注：IP数据报固定首部长度，MTU = 1500字节），则最后一个IP数据报片的数据字段的长度为（     ）字节。

得分/总分
你没有填写答案
正确答案：800
解析： 在计算原始IP数据报数据部分的长度时，需加上UDP的8字节首部（3752 + 8）=3760字节，因为3760/ 1480 = 2.54，因此需要分成3个数据报片。第三个分片数据部分的长度=3760-2*1480=800字节。

1单选(2分)
主机甲和主机乙建立TCP连接传输数据，假定主机甲的拥塞窗口cwnd=1000字节，接收方主机乙通告的接收窗口rwnd=2000字节，则主机甲的发送窗口的取值是（      ）字节。

得分/总分

A.
0


B.
3000


C.
2000


D.
1000

2.00/2.00
正确答案：D你选对了
解析：  D、TCP为了进行有效的拥塞控制，需要通过拥塞窗口cwnd（congestion window）来进行衡量网络的拥塞程度。注意，发送窗口的取值是取拥塞窗口和接收窗口中的较小的值，即Sendwin = Min［rwnd，cwnd］，所以本题的答案是1000字节。
2单选(2分)
TCP使用（      ）机制来建立连接。

得分/总分

A.
二次握手


B.
三次握手

2.00/2.00

C.
四次握手


D.
一次握手

正确答案：B你选对了
3单选(2分)
若主机甲和乙之间已建立一个TCP连接，双方持续有数据传输，数据无差错和丢失。若甲收到一个来自乙的TCP报文段，该段的Seq=1012，Ack=2046，该段的有效载荷是100字节，则甲立即发送给乙的TCP报文段中Seq和Ack分别是

得分/总分

A.
2046,1111 


B.
 2047,1111  


C.
 2046，1112  

2.00/2.00

D.
2047,1112

正确答案：C你选对了
解析：  C、甲收到一个来自乙的TCP报文段，该段的Seq=1012，Ack=2046，有效载荷是100字节，则甲立即发送给乙的TCP报文段中Seq=2046，Ack=1012+100=1112。
4单选(2分)
TCP报文段首部的16进制为04 85 00 50 2E 7C 84 03 FE 34 D7 47 50 11 FF 6C DE 69 00 00，则这个TCP报文段首部中源端口的值（16进制数）为


得分/总分

A.
84 03


B.
04 85

2.00/2.00

C.
00 50


D.
2E 7C

正确答案：B你选对了
解析：  B、端口是传输层与应用层的服务接口。在TCP报文段一开始的字段是源端口号，占16bit 。
5判断(2分)
在TCP的拥塞避免算法中，拥塞窗口大小按指数规律增长。

得分/总分

A.

B.2.00/2.00
正确答案：B你选对了
解析：在慢启动阶段，将拥塞窗口cwnd设置成一个报文段大小，并且当cwnd≤ssthresh时，采用指数规律增大cwnd（即每经过一个传输轮次，cwnd加倍）。所以，该说法是错误的。
6判断(2分)
TCP采用大小可变滑动窗口的方式进行流量控制。

得分/总分

A.2.00/2.00

B.
正确答案：A你选对了
7填空(2分)
如果TCP来回路程时间RTT的当前值是30ms，随后应答在34ms时候到来，取α=0.9，那么新的RTT估算值是（     ）ms。

得分/总分
30.4
 2.00/2.00
正确答案：30.4
解析： 每测量到一个新的往返时延样本，就按下式重新计算一次平均往返时延：
RTTnew = RTTsample（第一次测量得到的RTT样本值）
RTTnew＝ α×RTTold+（l-α）×RTTsample（第二次以后的测量）
则RTTnew＝ 0.9×30+（l-0.9）×34=30.4 ms
8填空(2分)
主机甲与主机乙之间建立一个TCP连接，主机甲向主机乙发送了两个连续的报文段，分别包含300字节和500字节的有效载荷，第一个报文段的序号为200，主机乙正确接收到两个段后，发送给主机甲的确认号为（      ）。

得分/总分
1000
 2.00/2.00
正确答案：1000
解析： 因为第一个报文段的序号是200，也就是说，第一个TCP报文段第一字节的编号是200，又因为第一个报文段和第二个报文段分别包含300字节和500字节的有效载荷，则第二个TCP报文段数据部分最后一个字节的编号是200+300+500-1=999，所以，主机乙正确接收到两个段后，发送给主机甲的确认号为最后一个字节的编号加1，即999+1=1000。
9填空(2分)
一个UDP用户数据报的数据字段长度为3752字节。若使用以太网来传送（注：IP数据报固定首部长度，MTU = 1500字节），则最后一个IP数据报片的数据字段的长度为（     ）字节。

得分/总分
792
 0.00/2.00
正确答案：800
解析： 在计算原始IP数据报数据部分的长度时，需加上UDP的8字节首部（3752 + 8）=3760字节，因为3760/ 1480 = 2.54，因此需要分成3个数据报片。第三个分片数据部分的长度=3760-2*1480=800字节。
10填空(2分)
一个UDP用户数据报的数据字段长度为3752字节。若使用以太网来传送（注：IP数据报固定首部长度，MTU = 1500字节），则需要分成（    ）个数据报片。

得分/总分
3
 2.00/2.00
正确答案：3
解析： 在计算原始IP数据报数据部分的长度时，需加上UDP的8字节首部（3752 + 8）=3760字节，因为3760/ 1480 = 2.54，因此需要分成3个数据报片。


3单选(2分)
一个TCP连接总是以1KB的最大段长发送TCP段，发送方有足够多的数据要发送。当拥塞窗口为16KB时发生了超时，如果接下来的4个RTT时间内的TCP段的传输都是成功的，那么当第4个RTT时间内发送的所有TCP段都得到肯定应答后，拥塞窗口大小为

得分/总分

A.
 16KB


B.
 9KB

2.00/2.00

C.
 8KB


D.
 7KB

正确答案：B你选对了
解析：  B、因为不管是在慢启动还是拥塞避免阶段，只要网络发生超时现象，则必须退回到慢启动阶段，拥塞窗口cwnd从1个MSS重新开始。当拥塞窗口为16KB时发生了超时，则1）执行拥塞避免算法的门限值调整为16KB的一半，即8KB,  2）立即执行慢启动算法，则第一个RTT后，cwnd=2KB，第二个RTT后，cwnd=4KB，第三个RTT后，cwnd=8KB，开始执行拥塞避免算法，所以第四个RTT后，cwnd=9KB。










